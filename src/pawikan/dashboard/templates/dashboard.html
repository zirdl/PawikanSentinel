{% extends "_base.html" %}

{% block title %}Dashboard - Pawikan Sentinel{% endblock %}

{% block content %}
    <h2 class="text-2xl font-bold mb-4">Welcome, {{ current_user.username }}!</h2>
    <p class="mb-6">This is the main dashboard. Analytics and other information will be displayed here.</p>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-surface text-on-surface p-6 rounded-lg shadow-md overflow-hidden">
            <h3 class="text-xl font-semibold mb-4">Detections Over Time</h3>
            <div class="relative h-96">
                <canvas id="detectionsChart"></canvas>
            </div>
        </div>
        <!-- Add more dashboard cards here -->
        <div class="bg-surface text-on-surface p-6 rounded-lg shadow-md">
            <h3 class="text-xl font-semibold mb-4">Detection Gallery</h3>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 max-h-96 overflow-y-auto">
                {% for image in gallery_images %}
                    <a href="/gallery-images/{{ image }}" class="glightbox block rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300">
                        <img src="/gallery-images/{{ image }}" alt="Detection Image" class="w-full h-32 object-cover">
                    </a>
                {% else %}
                    <p class="col-span-full text-center text-gray-600">No detection images found yet.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Chart.js initialization
        const ctx = document.getElementById('detectionsChart');
        const chartData = JSON.parse('{{ detection_data | safe }}');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartData.labels,
                datasets: [{
                    label: '# of Detections',
                    data: chartData.values,
                    borderWidth: 0,
                    borderColor: '#1976D2',
                    backgroundColor: 'rgba(25, 118, 210, 0.4)',
                    pointBackgroundColor: '#1976D2', /* Filled dot with primary color */
                    pointBorderColor: '#1976D2', /* Border color same as fill to hide it */
                    pointBorderWidth: 0, /* Explicitly remove border */
                    fill: true,
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        labels: {
                            color: '#212121',
                            boxWidth: 20, /* Default is 40, making it smaller */
                            boxHeight: 20, /* Adjust height if needed */
                            borderWidth: 0 /* Remove border from legend box */
                        }
                    }
                }
            }
        });
    </script>
{% endblock %}
