{% extends "base.html" %}

{% block title %}Login - Pawikan Sentinel{% endblock %}

{% block header %}{% endblock %}

{% block content %}
    <!-- Background SVG Logo -->
    <div class="fixed inset-0 z-0 flex items-center justify-center overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-sand-light/30 to-ocean-light/30"></div>
        <svg class="absolute w-full h-full scale-125 opacity-25 blur-sm" viewBox="0 0 285.75 285.75" xmlns="http://www.wwww.w3.org/2000/svg">
            <path id="path3" style="fill:none;stroke:#6b9ac4;stroke-width:3.63517;stroke-dasharray:none;stroke-opacity:1" d="m 142.79731,101.01873 c 0,0 -25.79699,0.37942 -34.91772,28.97514 -9.120715,28.59573 13.80217,52.23834 34.86257,64.82499 0.0317,0.0189 0.0787,0.0189 0.11039,0 21.0604,-12.58665 43.98329,-36.22926 34.86257,-64.82499 -9.12073,-28.59572 -34.91772,-28.97514 -34.91772,-28.97514 z" sodipodi:nodetypes="csaascc"/>
            <path id="path14" style="fill:none;stroke:#4a7b9d;stroke-width:5.71242;stroke-dasharray:none;stroke-opacity:1" d="m 142.7973,93.13611 c 0,0 -30.12992,0.443147 -40.78259,33.8419 -10.652665,33.39876 16.12041,61.01245 40.71818,75.71317 0.037,0.022 0.092,0.022 0.12893,0 24.59777,-14.70072 51.37085,-42.31441 40.71819,-75.71317 -10.65267,-33.398753 -40.7826,-33.8419 -40.7826,-33.8419 z" sodipodi:nodetypes="csaascc"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 127.04897,113.41165 c -0.34197,-1.02955 -0.38683,-1.54217 -0.17555,-2.00587 0.32948,-0.72314 2.94488,-2.24991 5.85505,-3.41796 l 2.03053,-0.81498 0.08,-2.22654 c 0.0699,-1.94655 -0.007,-2.38931 -0.61476,-3.52106 -1.56069,-2.908 -1.87126,-5.350024 -1.21309,-9.538592 0.16625,-1.057987 0.28784,-2.501967 0.27021,-3.208846 -0.024,-0.963091 0.12574,-1.479684 0.5975,-2.061013 0.34626,-0.426679 1.05693,-1.499039 1.57926,-2.383023 1.66971,-2.82575 3.81866,-4.13722 6.75771,-4.124118 1.61647,0.0072 2.17941,0.136868 3.20584,0.738395 1.56222,0.91552 2.75835,2.104859 4.01754,3.994732 0.54092,0.811855 1.20409,1.801393 1.47368,2.198973 0.27826,0.410372 0.4372,1.019868 0.36764,1.409879 -0.0674,0.377852 0.0697,1.428969 0.30474,2.335815 0.25301,0.976375 0.43928,2.937644 0.45676,4.809031 0.0288,3.087746 0.005,3.21478 -1.01478,5.539397 -0.90955,2.07225 -1.03363,2.60368 -0.9618,4.11927 0.0705,1.48724 0.16232,1.7552 0.63207,1.84413 0.86532,0.1638 5.82569,2.44966 6.99495,3.22344 0.5815,0.38483 1.12659,0.9647 1.21129,1.2886 0.18917,0.72339 -0.34084,2.94649 -0.70248,2.94649 -0.14455,0 -1.08824,-0.48959 -2.09708,-1.08797 -3.42761,-2.03305 -7.20189,-3.38071 -11.1316,-3.97469 -2.17781,-0.32917 -2.68623,-0.3157 -4.94643,0.13106 -4.12116,0.81463 -8.79687,2.63458 -11.50313,4.47743 l -1.01471,0.69099 z" id="path13"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 137.10615,130.47226 c -1.80135,-0.31553 -2.39457,-0.81684 -4.19891,-3.54838 -1.29247,-1.95665 -4.37095,-7.97347 -4.73528,-9.25498 -0.14587,-0.51314 0.10168,-0.76023 1.7317,-1.72863 4.24085,-2.51944 9.46582,-4.21894 12.962,-4.21606 2.88276,0.002 6.86304,1.12156 10.57986,2.97492 1.66256,0.82902 3.32584,1.74296 3.69618,2.03099 l 0.67336,0.52371 -1.06195,2.38328 c -2.20556,4.94981 -5.54873,10.05144 -6.97881,10.64955 -0.93569,0.39133 -10.6787,0.53409 -12.66815,0.1856 z" id="path12"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 173.00758,141.11145 c -0.31689,-4.82422 -1.49907,-9.19015 -3.64258,-13.45252 -2.1919,-4.35863 -4.21437,-6.97368 -8.17486,-10.57011 l -1.29812,-1.1788 0.73533,-0.96407 c 0.85485,-1.12077 1.63372,-1.62179 1.88618,-1.2133 0.34393,0.5565 0.63395,0.23945 1.22384,-1.33789 1.56657,-4.18898 4.9018,-7.54167 9.31122,-9.35998 8.19112,-3.377737 20.61616,-2.22596 30.83734,2.85857 2.02882,1.00924 5.93791,3.39856 6.84781,4.18555 0.4858,0.42017 -6.47218,2.66 -10.49699,3.37907 -2.75413,0.49204 -4.5122,0.5862 -12.09128,0.64753 -8.63129,0.0699 -8.94115,0.0914 -11.58112,0.80423 -2.99167,0.80785 -6.11741,2.23774 -7.646,3.49773 l -0.99218,0.81785 1.50785,2.25273 c 4.11669,6.1504 6.27795,12.71974 6.43454,19.55839 0.0554,2.41814 -0.0869,2.63927 -1.70276,2.64615 l -0.98905,0.004 z" id="path11"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 110.46924,143.4878 -0.65681,-0.12413 0.15997,-3.47957 c 0.29961,-6.51645 2.47393,-12.81826 6.39006,-18.52013 l 1.4594,-2.12489 -1.00053,-0.82473 c -1.47776,-1.21808 -4.524,-2.63486 -7.48149,-3.47952 -2.56478,-0.73252 -2.76502,-0.74681 -11.404275,-0.81366 -9.246875,-0.0716 -12.062151,-0.3345 -16.350707,-1.52718 -2.709597,-0.75356 -6.595902,-2.1626 -6.59275,-2.39031 0.0047,-0.33762 4.465035,-3.12972 7.11262,-4.45236 4.716874,-2.35639 9.551887,-3.74492 15.201702,-4.36564 7.3922,-0.81215 13.57248,0.25631 18.21321,3.14875 3.00409,1.87237 5.2547,4.62004 6.46566,7.89365 0.59937,1.62026 0.77096,1.79386 1.27499,1.28983 0.20384,-0.20384 0.54937,-0.0723 1.16036,0.44184 1.58329,1.33225 1.58161,1.58946 -0.0199,3.064 -7.18054,6.61106 -10.99644,14.4002 -11.65677,23.79415 -0.20681,2.94207 -0.143,2.87279 -2.2747,2.4699 z" id="path10"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 163.30316,145.60844 c -1.07737,-0.11593 -2.309,-0.37932 -2.73698,-0.58531 -1.03955,-0.50037 -3.54054,-4.22922 -5.674,-8.45963 -2.60044,-5.1564 -2.4821,-6.13177 1.58627,-13.07464 0.79708,-1.36028 1.84412,-3.01451 2.32674,-3.67609 l 0.87747,-1.20286 2.05483,2.02727 c 2.32723,2.29602 5.11357,6.28701 6.53072,9.35424 1.90295,4.11872 3.04488,9.65533 2.85299,13.83276 l -0.0884,1.92362 -2.88542,0.0357 c -1.58698,0.0196 -3.7669,-0.0591 -4.84426,-0.17506 z" id="path9"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 114.90458,145.72417 c -0.47588,-0.22107 -0.4449,-3.95388 0.0607,-7.30765 0.99323,-6.58901 4.33037,-13.10435 9.17383,-17.91071 l 1.88345,-1.86901 0.82786,1.05202 c 1.12983,1.43573 3.58415,5.77835 4.8575,8.59476 1.39902,3.09433 1.31424,4.00157 -0.75707,8.1022 -1.61994,3.20708 -3.76935,6.65453 -4.92363,7.89708 -0.37476,0.40342 -1.16027,0.86965 -1.7456,1.03609 -1.1647,0.33118 -8.82387,0.66216 -9.37698,0.40522 z" id="path8"/>
            <path style="fill:#6b9ac4;fill-opacity:1;stroke-width:1.03862" d="m 136.84162,160.42587 c -0.70946,-0.1392 -1.54613,-0.55545 -2.0108,-1.0004 -1.12474,-1.07698 -3.48587,-4.90965 -5.2037,-8.44685 -1.95215,-4.01972 -1.97518,-5.00458 -0.20275,-8.66972 1.50323,-3.10849 3.97087,-7.15116 5.24275,-8.5891 0.86123,-0.97367 1.05664,-1.0543 3.2521,-1.34197 2.88079,-0.37746 10.15899,-0.15332 11.66859,0.35935 1.29303,0.43912 2.48155,1.89726 4.66918,5.72837 3.89308,6.8178 4.07168,7.9141 1.99062,12.21863 -1.70683,3.53043 -3.75004,6.90218 -5.06011,8.35022 -0.85765,0.94798 -1.29866,1.19644 -2.51981,1.4196 -1.78346,0.32592 -10.1228,0.30608 -11.82607,-0.0282 z" id="path7"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 156.37828,169.32429 c -2.06518,-3.6783 -3.39991,-6.78175 -3.39991,-7.9053 0,-1.58337 2.14465,-6.05186 4.88358,-10.17515 2.64201,-3.9774 2.28619,-3.80914 8.32854,-3.93827 l 4.77571,-0.1021 -0.18439,1.33316 c -0.10147,0.73324 -0.55561,2.66239 -1.00931,4.287 -1.36814,4.89898 -3.13793,8.6273 -6.16976,12.99749 -1.54674,2.22953 -4.86417,6.18012 -5.36467,6.38856 -0.10688,0.0445 -0.94379,-1.25393 -1.85979,-2.88542 z" id="path6"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 125.37611,169.98963 c -4.04882,-4.69201 -7.19448,-10.11203 -8.86731,-15.27854 -0.89569,-2.76629 -1.84381,-7.0978 -1.60575,-7.33586 0.19673,-0.19672 7.19257,-0.16524 8.42675,0.0379 0.54271,0.0893 1.30836,0.28411 1.70146,0.43281 1.51126,0.5717 5.76018,7.55683 7.40261,12.16971 0.71632,2.01184 0.30705,3.2357 -3.10873,9.29638 -0.91572,1.62477 -1.73712,2.95379 -1.82536,2.95341 -0.0882,-3.9e-4 -1.04389,-1.02452 -2.12367,-2.27584 z" id="path5"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 142.17865,183.75781 c -2.66875,-1.49619 -8.71191,-5.88975 -11.12947,-8.09143 -0.52899,-0.48177 -1.27096,-1.12957 -1.64881,-1.43956 l -0.68701,-0.56363 1.49689,-2.89481 c 0.82329,-1.59215 2.18554,-3.91596 3.02722,-5.16404 2.25042,-3.33701 2.33947,-3.36861 9.49079,-3.3677 6.66,0.001 7.36785,0.15254 8.74895,1.87507 1.1141,1.38952 3.36542,5.13771 4.61724,7.68715 l 0.91746,1.86851 -1.09618,0.94924 c -4.18168,3.62113 -8.68575,6.98329 -11.70021,8.73388 -1.44082,0.83673 -1.3156,0.81169 -2.03687,0.40732 z" id="path4"/>
            <path style="fill:#4a7c59;fill-opacity:1;stroke-width:1.03862" d="m 139.84284,188.44106 c -5.81677,-3.70003 -12.23582,-8.84917 -12.70329,-10.19012 l -0.27813,-0.79787 -1.44394,2.15673 c -0.79417,1.18621 -1.91516,2.57048 -2.49108,3.07614 -2.30376,2.02272 -4.99465,2.49263 -7.37448,1.28781 -0.96592,-0.48901 -1.57779,-0.62134 -2.3772,-0.51412 -3.47358,0.4659 -4.89534,-2.69225 -2.94958,-6.55192 1.14124,-2.26382 4.40678,-5.55211 6.74045,-6.78743 0.94463,-0.50004 1.71751,-0.94736 1.71751,-0.99406 0,-0.0468 -0.57489,-0.93598 -1.27753,-1.97619 -1.78396,-2.64104 -4.29279,-7.92571 -5.46393,-11.50937 -1.02093,-3.12402 -2.21062,-9.22104 -1.93793,-9.93166 0.11305,-0.29463 0.50847,-0.38108 1.46304,-0.31988 l 1.30811,0.0839 0.21075,1.92361 c 0.2681,2.44714 1.33934,6.91719 2.21561,9.24522 4.08713,10.8585 13.4323,21.26943 25.93549,28.89331 l 1.70607,1.04029 2.14115,-1.29804 c 8.33445,-5.05259 16.29695,-12.4876 20.85033,-19.46906 3.71973,-5.70328 6.26797,-12.52715 6.92678,-18.54911 0.18695,-1.7089 0.22956,-1.79012 0.98432,-1.87638 0.43391,-0.0495 1.09402,-0.0136 1.46694,0.08 0.64426,0.16171 0.66885,0.24149 0.49381,1.60158 -0.94943,7.37688 -3.72408,14.6122 -8.20613,21.39879 l -0.48296,0.73127 1.7331,0.91748 c 2.34976,1.2439 5.61095,4.52425 6.75606,6.79574 1.89824,3.76542 0.51345,6.93366 -2.86422,6.55296 -0.89301,-0.10064 -1.50302,0.0273 -2.47426,0.519 -3.40384,1.72324 -6.75235,0.19831 -9.97048,-4.5406 l -1.17458,-1.72965 -0.496,0.8156 c -0.48944,0.80483 -3.50369,3.4394 -6.7443,5.89477 -2.67994,2.03057 -8.42728,5.70965 -8.89685,5.69519 -0.23763,-0.007 -1.60681,-0.76058 -3.04265,-1.67392 z" id="path1"/>
        </svg>
    </div>

    <div class="flex items-center justify-center min-h-screen relative z-10"> 
        <div class="bg-white bg-opacity-5 backdrop-filter backdrop-blur-lg rounded-2xl shadow-lg p-8 transition-all duration-300 ease-in-out hover:bg-opacity-10 w-full max-w-md fade-in">
            <h2 class="text-3xl font-extrabold text-center text-gray-800 mb-8">Login to Pawikan Sentinel</h2>

            {% if error %}
                <div class="p-3 rounded-lg font-medium flex items-center gap-2 mb-4 bg-red-100 border border-red-200 text-red-700" role="alert">
                    <i class="fas fa-exclamation-circle"></i>
                    <div>
                        <strong class="font-bold">Error!</strong>
                        <span class="block sm:inline">{{ error }}</span>
                    </div>
                </div>
            {% endif %}

            

            <form method="post" action="/login?next={{ next_url }}" class="space-y-6">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input type="text" id="username" name="username" required autocomplete="username"
                           class="w-full p-3 border border-gray-300 rounded-lg bg-white bg-opacity-80 text-base transition-all duration-300 ease-in-out focus:outline-none focus:border-turtle-green focus:ring-4 focus:ring-turtle-green focus:ring-opacity-20">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <div class="relative">
                        <input type="password" id="password" name="password" required autocomplete="current-password"
                               class="w-full p-3 pr-12 border border-gray-300 rounded-lg bg-white bg-opacity-80 text-base transition-all duration-300 ease-in-out focus:outline-none focus:border-turtle-green focus:ring-4 focus:ring-turtle-green focus:ring-opacity-20">
                        <button type="button" class="absolute right-3 top-1/2 transform -translate-y-1/2 border-none cursor-pointer text-turtle-dark-green text-base p-0 rounded-lg transition-all duration-200 ease-in-out flex items-center justify-center w-6 h-6 text-center leading-none z-10" onclick="togglePasswordVisibility('password', 'password-icon')">
                            <i id="password-icon" class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button type="submit"
                        class="w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-gradient-to-r from-turtle-green to-ocean-blue hover:from-turtle-dark-green hover:to-ocean-dark-blue focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-turtle-green transition-transform duration-300 ease-in-out hover:-translate-y-0.5">
                    <i class="fas fa-sign-in-alt mr-2"></i> Login
                </button>
            </form>
            <!-- Only admin account is available -->
            <p class="mt-8 text-center text-sm text-gray-600">
                Only the admin account is available for login.
            </p>
        </div>
    </div>

    <!-- JavaScript to handle browser back button and ensure redirection when already authenticated -->
    <script>
        // Check if we have an access token in cookies
        function hasAccessToken() {
            return document.cookie.split(';').some((item) => {
                return item.trim().startsWith('access_token=');
            });
        }

        // On page load, if we have a token, redirect to dashboard
        if (hasAccessToken()) {
            window.location.href = '/dashboard';
        }

        // Also handle when the page is restored from bfcache (back-forward cache)
        window.addEventListener('pageshow', function(event) {
            if (event.persisted && hasAccessToken()) {
                // If page was restored from bfcache and user is logged in, redirect to dashboard
                window.location.href = '/dashboard';
            }
        });
    </script>
{% endblock %}